---
title: "Flask"
order: 8.01.01
parent: "08-01-web-frameworks.md"
tags: ["python", "flask", "web", "framework"]
---

# Flask

Flask est un framework web minimaliste et flexible, permettant de construire des applications de la taille que vous souhaitez. C'est le framework idéal pour apprendre et pour les projets qui nécessitent de la flexibilité.

## Concepts de base

**Flask** est un micro-framework : il fournit le minimum nécessaire pour créer une application web, et vous ajoutez ce dont vous avez besoin. Cette approche "explicit is better than implicit" est très Pythonic.

### Philosophie Flask

- **Minimaliste** : Pas de dépendances inutiles
- **Flexible** : Vous choisissez vos outils
- **Extensible** : Beaucoup d'extensions disponibles
- **Simple** : Courbe d'apprentissage douce

## Installation et configuration

### Installation

```bash
# Installer Flask
pip install flask

# Ou avec Poetry
poetry add flask
```

### Application minimale

```python
# app.py
from flask import Flask

app = Flask(__name__)

@app.route('/')
def hello():
    return 'Hello, World!'

if __name__ == '__main__':
    app.run(debug=True)
```

Exécution :

```bash
python app.py
# * Running on http://127.0.0.1:5000
```

### Structure de projet recommandée

```
mon-projet/
├── app.py
├── templates/
│   └── index.html
├── static/
│   ├── css/
│   └── js/
├── requirements.txt
└── README.md
```

## Routes et vues

### Routes de base

```python
from flask import Flask

app = Flask(__name__)

@app.route('/')
def index():
    return 'Page d\'accueil'

@app.route('/about')
def about():
    return 'À propos'

@app.route('/user/<username>')
def show_user(username):
    return f'Utilisateur: {username}'

@app.route('/post/<int:post_id>')
def show_post(post_id):
    return f'Post #{post_id}'
```

### Méthodes HTTP

```python
from flask import Flask, request

app = Flask(__name__)

# Par défaut, seulement GET
@app.route('/users')
def get_users():
    return {'users': ['Alice', 'Bob']}

# Spécifier plusieurs méthodes
@app.route('/users', methods=['GET', 'POST'])
def users():
    if request.method == 'POST':
        # Créer un utilisateur
        return {'message': 'Utilisateur créé'}, 201
    else:
        # Lister les utilisateurs
        return {'users': ['Alice', 'Bob']}

# Ou utiliser des décorateurs séparés
@app.get('/users')
def list_users():
    return {'users': ['Alice', 'Bob']}

@app.post('/users')
def create_user():
    return {'message': 'Utilisateur créé'}, 201
```

### Variables de route

```python
@app.route('/user/<username>')
def show_user(username):
    return f'Utilisateur: {username}'

# Types de convertisseurs
@app.route('/post/<int:post_id>')      # Entier
def show_post(post_id):
    return f'Post #{post_id}'

@app.route('/path/<path:subpath>')     # Chemin
def show_subpath(subpath):
    return f'Sous-chemin: {subpath}'

@app.route('/uuid/<uuid:uuid_value>')  # UUID
def show_uuid(uuid_value):
    return f'UUID: {uuid_value}'
```

## Templates et statiques

### Templates Jinja2

Flask utilise Jinja2 pour les templates :

```python
from flask import Flask, render_template

app = Flask(__name__)

@app.route('/')
def index():
    return render_template('index.html', name='Alice')

@app.route('/users')
def users():
    users = ['Alice', 'Bob', 'Charlie']
    return render_template('users.html', users=users)
```

```html
<!-- templates/index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Accueil</title>
</head>
<body>
    <h1>Bonjour, {{ name }}!</h1>
</body>
</html>
```

```html
<!-- templates/users.html -->
<!DOCTYPE html>
<html>
<body>
    <h1>Utilisateurs</h1>
    <ul>
        {% for user in users %}
        <li>{{ user }}</li>
        {% endfor %}
    </ul>
</body>
</html>
```

### Fichiers statiques

```python
# Fichiers statiques dans static/
# static/css/style.css
# static/js/script.js

# Utilisation dans les templates
# <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
```

## Requêtes et réponses

### Accéder aux données de requête

```python
from flask import Flask, request, jsonify

app = Flask(__name__)

@app.route('/api/data', methods=['POST'])
def receive_data():
    # Données JSON
    data = request.get_json()
    
    # Paramètres de requête
    param = request.args.get('param')
    
    # Données de formulaire
    form_data = request.form.get('field')
    
    # Headers
    content_type = request.headers.get('Content-Type')
    
    return jsonify({'received': data})
```

### Retourner des réponses

```python
from flask import Flask, jsonify, make_response

app = Flask(__name__)

@app.route('/api/users')
def get_users():
    # Retourner du JSON
    return jsonify({'users': ['Alice', 'Bob']})

@app.route('/api/custom')
def custom_response():
    # Réponse personnalisée
    response = make_response('Contenu personnalisé')
    response.headers['X-Custom-Header'] = 'Valeur'
    response.status_code = 201
    return response
```

## Extensions Flask

### Flask-SQLAlchemy (ORM)

```python
from flask import Flask
from flask_sqlalchemy import SQLAlchemy

app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///db.sqlite'
db = SQLAlchemy(app)

class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(80), unique=True, nullable=False)
    email = db.Column(db.String(120), unique=True, nullable=False)

    def __repr__(self):
        return f'<User {self.username}>'

# Créer les tables
with app.app_context():
    db.create_all()
```

### Flask-RESTful (APIs)

```python
from flask import Flask
from flask_restful import Api, Resource

app = Flask(__name__)
api = Api(app)

class UserAPI(Resource):
    def get(self, user_id):
        return {'user_id': user_id}
    
    def put(self, user_id):
        return {'message': 'User updated'}

api.add_resource(UserAPI, '/users/<int:user_id>')
```

### Flask-JWT-Extended (Authentification)

```python
from flask import Flask
from flask_jwt_extended import JWTManager, create_access_token

app = Flask(__name__)
app.config['JWT_SECRET_KEY'] = 'super-secret'
jwt = JWTManager(app)

@app.route('/login', methods=['POST'])
def login():
    # Vérifier les credentials
    access_token = create_access_token(identity='user_id')
    return {'access_token': access_token}
```

## Cas d'usage

### Cas d'usage 1 : API REST simple

```python
from flask import Flask, jsonify, request
from flask.views import MethodView

app = Flask(__name__)

users = []

class UserAPI(MethodView):
    def get(self, user_id=None):
        if user_id:
            user = next((u for u in users if u['id'] == user_id), None)
            if user:
                return jsonify(user)
            return jsonify({'error': 'Not found'}), 404
        return jsonify(users)
    
    def post(self):
        data = request.get_json()
        user = {
            'id': len(users) + 1,
            'name': data.get('name'),
            'email': data.get('email')
        }
        users.append(user)
        return jsonify(user), 201
    
    def put(self, user_id):
        user = next((u for u in users if u['id'] == user_id), None)
        if not user:
            return jsonify({'error': 'Not found'}), 404
        
        data = request.get_json()
        user.update(data)
        return jsonify(user)
    
    def delete(self, user_id):
        global users
        users = [u for u in users if u['id'] != user_id]
        return '', 204

# Enregistrer les routes
user_view = UserAPI.as_view('user_api')
app.add_url_rule('/users', view_func=user_view, methods=['GET', 'POST'])
app.add_url_rule('/users/<int:user_id>', view_func=user_view, methods=['GET', 'PUT', 'DELETE'])
```

### Cas d'usage 2 : Application avec templates

```python
from flask import Flask, render_template, request, redirect, url_for, flash

app = Flask(__name__)
app.secret_key = 'secret-key'  # Pour les messages flash

tasks = []

@app.route('/')
def index():
    return render_template('index.html', tasks=tasks)

@app.route('/add', methods=['POST'])
def add_task():
    task = request.form.get('task')
    if task:
        tasks.append(task)
        flash('Tâche ajoutée!')
    return redirect(url_for('index'))

@app.route('/delete/<int:index>')
def delete_task(index):
    if 0 <= index < len(tasks):
        tasks.pop(index)
        flash('Tâche supprimée!')
    return redirect(url_for('index'))
```

### Cas d'usage 3 : Application modulaire

```python
# app.py
from flask import Flask

def create_app():
    app = Flask(__name__)
    
    # Configuration
    app.config['SECRET_KEY'] = 'secret-key'
    
    # Enregistrer les blueprints
    from routes import main_bp, api_bp
    app.register_blueprint(main_bp)
    app.register_blueprint(api_bp, url_prefix='/api')
    
    return app

if __name__ == '__main__':
    app = create_app()
    app.run(debug=True)
```

```python
# routes.py
from flask import Blueprint, render_template, jsonify

main_bp = Blueprint('main', __name__)
api_bp = Blueprint('api', __name__)

@main_bp.route('/')
def index():
    return render_template('index.html')

@api_bp.route('/users')
def get_users():
    return jsonify({'users': ['Alice', 'Bob']})
```

## Bonnes pratiques

### 1. Utilisez des blueprints pour organiser

```python
# ✅ Bon : organisation avec blueprints
from flask import Blueprint

api = Blueprint('api', __name__, url_prefix='/api')

@api.route('/users')
def users():
    return jsonify({'users': []})
```

### 2. Configuration par environnement

```python
# config.py
import os

class Config:
    SECRET_KEY = os.environ.get('SECRET_KEY') or 'dev-key'
    SQLALCHEMY_DATABASE_URI = os.environ.get('DATABASE_URL')

class DevelopmentConfig(Config):
    DEBUG = True

class ProductionConfig(Config):
    DEBUG = False

# app.py
app.config.from_object(DevelopmentConfig)
```

### 3. Gestion d'erreurs

```python
@app.errorhandler(404)
def not_found(error):
    return jsonify({'error': 'Not found'}), 404

@app.errorhandler(500)
def internal_error(error):
    return jsonify({'error': 'Internal server error'}), 500
```

## Points clés à retenir

- ✅ Flask est un **micro-framework** minimaliste et flexible
- ✅ **Simple à apprendre** : application minimale en quelques lignes
- ✅ **Extensible** : beaucoup d'extensions disponibles
- ✅ Utilise **Jinja2** pour les templates
- ✅ **Blueprints** pour organiser les grandes applications
- ✅ Parfait pour les **petites à moyennes applications**
- ✅ Vous choisissez vos outils (pas de "magie" cachée)

Flask est idéal pour apprendre le développement web Python et pour les projets qui nécessitent de la flexibilité. Sa simplicité en fait un excellent choix pour débuter.
