---
title: "venv"
order: 7.01.01
parent: "07-01-environnements.md"
tags: ["python", "venv", "environnement-virtuel"]
---

# venv

Le module `venv` est la solution standard pour créer des environnements virtuels Python isolés. C'est l'outil recommandé depuis Python 3.3+ et essentiel pour gérer les dépendances de vos projets.

## Concepts de base

Un **environnement virtuel** est un répertoire isolé qui contient :
- Une copie de l'interpréteur Python
- Le gestionnaire de packages `pip`
- Les packages installés pour ce projet spécifique

Cela permet d'avoir des versions différentes de packages pour différents projets sans conflits.

### Pourquoi utiliser venv ?

Sans environnement virtuel, tous les packages sont installés globalement :

```python
# ❌ Sans venv : installation globale
pip install requests==2.25.1  # Version pour projet A
pip install requests==2.28.0  # ⚠️ Écrase la version précédente
# Projet A et B partagent les mêmes packages → conflits possibles
```

Avec venv, chaque projet a son propre environnement :

```python
# ✅ Avec venv : isolation
projet_a/venv/  # requests==2.25.1
projet_b/venv/  # requests==2.28.0
# Pas de conflit, chaque projet a ses propres dépendances
```

## Création d'un environnement virtuel

### Commande de base

```bash
# Créer un environnement virtuel
python -m venv nom_env

# Ou avec python3
python3 -m venv nom_env
```

### Exemple pratique

```bash
# Créer un environnement pour un projet
cd mon_projet
python -m venv venv

# Structure créée
mon_projet/
├── venv/
│   ├── bin/          # Scripts (Linux/Mac)
│   ├── Scripts/       # Scripts (Windows)
│   ├── lib/          # Packages installés
│   └── pyvenv.cfg    # Configuration
└── ...
```

### Options utiles

```bash
# Créer avec un interpréteur Python spécifique
python3.9 -m venv venv

# Créer sans pip (rare)
python -m venv venv --without-pip

# Créer avec des packages système (rare)
python -m venv venv --system-site-packages
```

## Activation et désactivation

### Windows

```powershell
# Activation
venv\Scripts\Activate.ps1

# Ou avec cmd
venv\Scripts\activate.bat

# Désactivation
deactivate
```

### Linux / macOS

```bash
# Activation
source venv/bin/activate

# Ou
. venv/bin/activate

# Désactivation
deactivate
```

### Vérification

Après activation, le prompt change et `which python` pointe vers l'environnement virtuel :

```bash
# Avant activation
$ which python
/usr/bin/python

# Après activation
(venv) $ which python
/path/to/mon_projet/venv/bin/python

# Le prompt montre (venv)
(venv) $ python --version
Python 3.9.0
```

## Gestion des dépendances

### Installation de packages

```bash
# Activer l'environnement d'abord
source venv/bin/activate  # Linux/Mac
# ou
venv\Scripts\activate  # Windows

# Installer des packages
pip install requests
pip install flask==2.0.0
pip install "django>=3.0,<4.0"
```

### Sauvegarder les dépendances

```bash
# Générer requirements.txt
pip freeze > requirements.txt

# Contenu de requirements.txt
# requests==2.28.0
# flask==2.0.0
# django==3.2.0
```

### Restaurer les dépendances

```bash
# Créer un nouvel environnement
python -m venv venv
source venv/bin/activate  # Activer

# Installer depuis requirements.txt
pip install -r requirements.txt
```

### requirements.txt complet

```bash
# Générer avec versions exactes
pip freeze > requirements.txt

# Ou créer manuellement avec versions flexibles
# requirements.txt
requests>=2.25.0,<3.0.0
flask>=2.0.0
django>=3.0,<4.0
pytest>=7.0.0  # Dépendance de développement
```

## Bonnes pratiques

### 1. Un environnement par projet

```bash
# ✅ Bon : environnement dans le projet
mon_projet/
├── venv/
├── src/
└── requirements.txt

# ⚠️ Moins bon : environnement partagé
environnements/
└── venv_global/  # Partagé entre projets
```

### 2. Ignorer venv dans Git

Ajoutez `venv/` au `.gitignore` :

```gitignore
# .gitignore
venv/
env/
.venv/
*.pyc
__pycache__/
```

### 3. Documenter les dépendances

```bash
# ✅ Toujours avoir un requirements.txt à jour
pip freeze > requirements.txt

# ✅ Inclure les dépendances de développement
pip freeze > requirements-dev.txt
```

### 4. Utiliser des versions spécifiques en production

```bash
# ✅ Production : versions exactes
pip freeze > requirements.txt

# ✅ Développement : versions flexibles (dans setup.py ou pyproject.toml)
```

## Exemples pratiques

### Exemple 1 : Workflow complet

```bash
# 1. Créer le projet
mkdir mon_projet
cd mon_projet

# 2. Créer l'environnement virtuel
python -m venv venv

# 3. Activer l'environnement
source venv/bin/activate  # Linux/Mac
# ou
venv\Scripts\activate  # Windows

# 4. Installer les dépendances
pip install requests flask

# 5. Développer votre code
# ...

# 6. Sauvegarder les dépendances
pip freeze > requirements.txt

# 7. Désactiver quand terminé
deactivate
```

### Exemple 2 : Projet avec dépendances de développement

```bash
# Créer et activer l'environnement
python -m venv venv
source venv/bin/activate

# Installer les dépendances de production
pip install requests flask

# Installer les dépendances de développement
pip install pytest black mypy

# Sauvegarder
pip freeze > requirements.txt
pip freeze > requirements-dev.txt

# Ou séparer
# requirements.txt (production)
requests>=2.25.0
flask>=2.0.0

# requirements-dev.txt (développement)
-r requirements.txt
pytest>=7.0.0
black>=22.0.0
mypy>=0.950
```

### Exemple 3 : Migration entre machines

```bash
# Machine A : exporter
pip freeze > requirements.txt

# Machine B : importer
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

### Exemple 4 : Environnement pour script spécifique

```bash
# Script qui nécessite une version spécifique
python -m venv script_env
source script_env/bin/activate
pip install package==1.2.3
python mon_script.py
deactivate
```

## Commandes utiles

### Vérifier l'environnement actif

```bash
# Vérifier quel Python est utilisé
which python  # Linux/Mac
where python  # Windows

# Vérifier les packages installés
pip list

# Vérifier un package spécifique
pip show requests
```

### Mettre à jour pip

```bash
# Dans l'environnement virtuel
python -m pip install --upgrade pip
```

### Nettoyer l'environnement

```bash
# Désinstaller tous les packages
pip freeze | xargs pip uninstall -y

# Ou simplement supprimer et recréer
rm -rf venv
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

## Pièges courants

### Piège 1 : Oublier d'activer l'environnement

```bash
# ❌ Installation globale par erreur
pip install requests  # ⚠️ Installe globalement si venv pas activé

# ✅ Toujours vérifier
which python  # Doit pointer vers venv/bin/python
```

### Piège 2 : Commiter venv dans Git

```bash
# ❌ Ne jamais commiter venv/
git add venv/  # ⚠️ Très lourd et inutile

# ✅ Ajouter au .gitignore
echo "venv/" >> .gitignore
```

### Piège 3 : Oublier requirements.txt

```bash
# ❌ Oubli de sauvegarder
pip install package
# Pas de requirements.txt → dépendances perdues

# ✅ Toujours mettre à jour
pip install package
pip freeze > requirements.txt
```

## Comparaison avec d'autres outils

### venv vs virtualenv

```bash
# venv : standard (Python 3.3+)
python -m venv venv

# virtualenv : outil externe (plus ancien)
pip install virtualenv
virtualenv venv

# ✅ Préférez venv (inclus dans Python)
```

### venv vs conda

- **venv** : Simple, standard, pour projets Python purs
- **conda** : Plus complexe, gère aussi les dépendances non-Python (C libraries, etc.)

## Points clés à retenir

- ✅ `venv` crée des **environnements isolés** pour chaque projet
- ✅ **Activez** l'environnement avant d'installer des packages
- ✅ Utilisez `pip freeze > requirements.txt` pour **sauvegarder** les dépendances
- ✅ **Un environnement par projet** est la bonne pratique
- ✅ **Ignorez venv/** dans Git (ajoutez au .gitignore)
- ✅ Vérifiez toujours que l'environnement est **activé** avec `which python`
- ✅ `venv` est **standard** depuis Python 3.3+ (préférez-le à virtualenv)

Les environnements virtuels sont essentiels en Python. Ils permettent d'isoler les dépendances et d'éviter les conflits entre projets. Utilisez-les systématiquement pour tous vos projets.
