---
title: "Click"
order: 8.03.02
parent: "08-03-scripts-automation-cli.md"
tags: ["python", "click", "cli", "framework"]
---

# Click

Click est un framework moderne et puissant pour créer des interfaces en ligne de commande élégantes et intuitives. Il simplifie la création de CLIs par rapport à argparse.

## Concepts de base

**Click** est une bibliothèque Python qui permet de créer des CLIs rapidement avec une syntaxe déclarative. Elle automatise beaucoup de tâches fastidieuses.

### Avantages de Click

- **Déclaratif** : Syntaxe simple et intuitive
- **Automatique** : Génération automatique de l'aide et validation
- **Composable** : Facile de créer des commandes complexes
- **Cross-platform** : Fonctionne sur tous les systèmes
- **Extensions** : Beaucoup d'extensions disponibles

## Installation et configuration

### Installation

```bash
# Installer Click
pip install click

# Ou avec Poetry
poetry add click
```

### Commande simple

```python
import click

@click.command()
@click.option('--name', default='World', help='Nom à saluer')
def hello(name):
    """Simple programme qui salue."""
    click.echo(f'Hello {name}!')

if __name__ == '__main__':
    hello()
```

Exécution :

```bash
python script.py
# Hello World!

python script.py --name Alice
# Hello Alice!

python script.py --help
# Usage: script.py [OPTIONS]
# 
#   Simple programme qui salue.
# 
# Options:
#   --name TEXT  Nom à saluer
#   --help       Show this message and exit.
```

## Commandes et groupes

### Commandes simples

```python
import click

@click.command()
def hello():
    """Affiche un message de salutation."""
    click.echo('Hello, World!')

if __name__ == '__main__':
    hello()
```

### Groupes de commandes

```python
import click

@click.group()
def cli():
    """Gestionnaire de fichiers."""
    pass

@cli.command()
def init():
    """Initialise le projet."""
    click.echo('Initialisation...')

@cli.command()
def status():
    """Affiche le statut."""
    click.echo('Statut...')

if __name__ == '__main__':
    cli()
```

Exécution :

```bash
python script.py init
python script.py status
python script.py --help
```

### Groupes imbriqués

```python
import click

@click.group()
def cli():
    """CLI principal."""
    pass

@cli.group()
def user():
    """Gestion des utilisateurs."""
    pass

@user.command()
def create():
    """Crée un utilisateur."""
    click.echo('Création utilisateur...')

@user.command()
def delete():
    """Supprime un utilisateur."""
    click.echo('Suppression utilisateur...')

if __name__ == '__main__':
    cli()
```

## Options et arguments

### Options

```python
import click

@click.command()
@click.option('--name', default='World', help='Nom à saluer')
@click.option('--count', default=1, type=int, help='Nombre de fois')
def hello(name, count):
    """Salue quelqu'un."""
    for _ in range(count):
        click.echo(f'Hello {name}!')
```

### Options avec flags

```python
import click

@click.command()
@click.option('--verbose', is_flag=True, help='Mode verbeux')
@click.option('--force', is_flag=True, help='Forcer l\'opération')
def deploy(verbose, force):
    """Déploie l'application."""
    if verbose:
        click.echo('Mode verbeux activé')
    if force:
        click.echo('Mode forcé activé')
    click.echo('Déploiement...')
```

### Options avec choix

```python
import click

@click.command()
@click.option('--format', type=click.Choice(['json', 'xml', 'csv']), default='json')
def export(format):
    """Exporte les données."""
    click.echo(f'Export en format {format}')
```

### Arguments

```python
import click

@click.command()
@click.argument('filename')
def process(filename):
    """Traite un fichier."""
    click.echo(f'Traitement de {filename}')
```

### Arguments multiples

```python
import click

@click.command()
@click.argument('files', nargs=-1)
def process(files):
    """Traite plusieurs fichiers."""
    for file in files:
        click.echo(f'Traitement de {file}')
```

### Options et arguments combinés

```python
import click

@click.command()
@click.option('--output', '-o', help='Fichier de sortie')
@click.argument('input_file')
def convert(input_file, output):
    """Convertit un fichier."""
    click.echo(f'Conversion de {input_file}')
    if output:
        click.echo(f'Vers {output}')
```

## Types et validation

### Types de base

```python
import click

@click.command()
@click.option('--count', type=int, help='Nombre')
@click.option('--price', type=float, help='Prix')
@click.option('--active', type=bool, help='Actif')
def example(count, price, active):
    """Exemple avec différents types."""
    click.echo(f'Count: {count}, Price: {price}, Active: {active}')
```

### Validation personnalisée

```python
import click

def validate_port(ctx, param, value):
    if not 1 <= value <= 65535:
        raise click.BadParameter('Le port doit être entre 1 et 65535')
    return value

@click.command()
@click.option('--port', type=int, callback=validate_port)
def server(port):
    """Démarre le serveur."""
    click.echo(f'Serveur sur le port {port}')
```

### Types personnalisés

```python
import click

class PortType(click.ParamType):
    name = "port"
    
    def convert(self, value, param, ctx):
        try:
            port = int(value)
            if not 1 <= port <= 65535:
                self.fail(f'{value} n\'est pas un port valide (1-65535)', param, ctx)
            return port
        except ValueError:
            self.fail(f'{value} n\'est pas un nombre', param, ctx)

@click.command()
@click.option('--port', type=PortType())
def server(port):
    """Démarre le serveur."""
    click.echo(f'Serveur sur le port {port}')
```

## Avantages par rapport à argparse

### Syntaxe plus simple

```python
# Click
@click.command()
@click.option('--name', default='World')
def hello(name):
    click.echo(f'Hello {name}!')

# argparse (équivalent)
import argparse
parser = argparse.ArgumentParser()
parser.add_argument('--name', default='World')
args = parser.parse_args()
print(f'Hello {args.name}!')
```

### Validation automatique

```python
# Click : validation automatique des types
@click.option('--port', type=int)
def server(port):
    pass

# argparse : validation manuelle
parser.add_argument('--port', type=int)
args = parser.parse_args()
if not 1 <= args.port <= 65535:
    raise ValueError('Port invalide')
```

### Groupes plus faciles

```python
# Click : groupes avec décorateurs
@click.group()
def cli():
    pass

@cli.command()
def cmd():
    pass

# argparse : groupes plus verbeux
parser = argparse.ArgumentParser()
subparsers = parser.add_subparsers()
cmd_parser = subparsers.add_parser('cmd')
```

## Fonctionnalités avancées

### Prompts interactifs

```python
import click

@click.command()
@click.option('--name', prompt='Votre nom', help='Nom de l\'utilisateur')
@click.option('--password', prompt=True, hide_input=True, confirmation_prompt=True)
def create_user(name, password):
    """Crée un utilisateur."""
    click.echo(f'Création de {name}')
```

### Confirmation

```python
import click

@click.command()
@click.confirmation_option(prompt='Êtes-vous sûr?')
def delete():
    """Supprime quelque chose."""
    click.echo('Suppression...')
```

### Progress bars

```python
import click
import time

@click.command()
def process():
    """Traite des données avec barre de progression."""
    with click.progressbar(range(100), label='Traitement') as bar:
        for i in bar:
            time.sleep(0.01)
    click.echo('Terminé!')
```

### Coloration

```python
import click

@click.command()
def example():
    """Exemple avec couleurs."""
    click.echo(click.style('Succès', fg='green'))
    click.echo(click.style('Erreur', fg='red'))
    click.echo(click.style('Avertissement', fg='yellow'))
    click.echo(click.style('Info', fg='blue'))
```

### Fichiers

```python
import click

@click.command()
@click.option('--input', type=click.File('r'), required=True)
@click.option('--output', type=click.File('w'), required=True)
def process(input, output):
    """Traite un fichier."""
    content = input.read()
    output.write(content.upper())
```

## Exemples pratiques

### Exemple 1 : CLI de gestion de fichiers

```python
import click
import os

@click.group()
def cli():
    """Gestionnaire de fichiers."""
    pass

@cli.command()
@click.argument('filename')
@click.option('--content', default='', help='Contenu du fichier')
def create(filename, content):
    """Crée un fichier."""
    with open(filename, 'w') as f:
        f.write(content)
    click.echo(f'Fichier {filename} créé')

@cli.command()
@click.argument('filename')
@click.confirmation_option(prompt='Êtes-vous sûr de vouloir supprimer?')
def delete(filename):
    """Supprime un fichier."""
    if os.path.exists(filename):
        os.remove(filename)
        click.echo(f'Fichier {filename} supprimé')
    else:
        click.echo(f'Fichier {filename} introuvable', err=True)

@cli.command()
@click.argument('files', nargs=-1)
@click.option('--verbose', is_flag=True, help='Mode verbeux')
def list(files, verbose):
    """Liste les fichiers."""
    if not files:
        files = ['.']
    
    for path in files:
        if os.path.isdir(path):
            if verbose:
                click.echo(f'Répertoire: {path}')
            for item in os.listdir(path):
                click.echo(item)
        else:
            click.echo(path)

if __name__ == '__main__':
    cli()
```

### Exemple 2 : CLI avec contexte

```python
import click

@click.group()
@click.option('--verbose', is_flag=True, help='Mode verbeux')
@click.pass_context
def cli(ctx, verbose):
    """CLI avec contexte partagé."""
    ctx.ensure_object(dict)
    ctx.obj['verbose'] = verbose

@cli.command()
@click.pass_context
def status(ctx):
    """Affiche le statut."""
    if ctx.obj['verbose']:
        click.echo('Mode verbeux activé')
    click.echo('Statut: OK')

@cli.command()
@click.pass_context
def deploy(ctx):
    """Déploie l'application."""
    if ctx.obj['verbose']:
        click.echo('Démarrage du déploiement...')
    click.echo('Déploiement terminé')

if __name__ == '__main__':
    cli()
```

### Exemple 3 : CLI avec configuration

```python
import click
import json
import os

@click.group()
@click.option('--config', type=click.Path(exists=True), help='Fichier de configuration')
@click.pass_context
def cli(ctx, config):
    """CLI avec configuration."""
    ctx.ensure_object(dict)
    
    if config:
        with open(config, 'r') as f:
            ctx.obj['config'] = json.load(f)
    else:
        ctx.obj['config'] = {}

@cli.command()
@click.option('--name', prompt='Nom', help='Nom de l\'utilisateur')
@click.option('--email', prompt='Email', help='Email')
@click.pass_context
def create_user(ctx, name, email):
    """Crée un utilisateur."""
    config = ctx.obj.get('config', {})
    click.echo(f'Création de {name} ({email})')
    if config.get('verbose'):
        click.echo('Mode verbeux depuis la config')

if __name__ == '__main__':
    cli()
```

## Bonnes pratiques

### 1. Utilisez des docstrings

```python
# ✅ Bon
@click.command()
def hello():
    """Salue quelqu'un."""
    click.echo('Hello!')
```

### 2. Messages d'aide clairs

```python
# ✅ Bon
@click.option('--output', help='Fichier de sortie (obligatoire)')

# ❌ Éviter
@click.option('--output')
```

### 3. Valeurs par défaut sensées

```python
# ✅ Bon
@click.option('--port', default=8080, help='Port du serveur')

# ❌ Éviter
@click.option('--port', help='Port')  # Pas de défaut
```

### 4. Utilisez les types appropriés

```python
# ✅ Bon
@click.option('--count', type=int, help='Nombre')

# ❌ Éviter
@click.option('--count', help='Nombre')  # Pas de type
```

## Points clés à retenir

- ✅ Click offre une **syntaxe déclarative** simple
- ✅ **Validation automatique** des types
- ✅ **Génération automatique** de l'aide
- ✅ **Fonctionnalités avancées** : prompts, progress bars, couleurs
- ✅ **Composable** : facile de créer des commandes complexes
- ✅ **Plus simple** que argparse pour la plupart des cas
- ✅ Parfait pour créer des **CLIs modernes et élégantes**

Click est le choix idéal pour créer des interfaces en ligne de commande modernes et intuitives. Sa syntaxe déclarative et ses fonctionnalités avancées en font un framework très productif.
