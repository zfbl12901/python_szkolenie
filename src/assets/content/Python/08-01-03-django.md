---
title: "Django"
order: 8.01.03
parent: "08-01-web-frameworks.md"
tags: ["python", "django", "framework", "full-stack"]
---

# Django

Django est un framework web full-stack "batteries included", offrant tout ce dont vous avez besoin pour développer rapidement des applications web complètes.

## Concepts de base

**Django** suit le principe "batteries included" : il fournit tout ce dont vous avez besoin pour développer une application web complète, de l'ORM à l'interface d'administration.

### Philosophie Django

- **Complet** : ORM, authentification, admin, templates, etc.
- **Sécurisé** : Protection contre les vulnérabilités courantes
- **Scalable** : Architecture pour les grandes applications
- **Rapide** : Développement rapide grâce aux outils intégrés

### Architecture MVC (MTV)

Django utilise le pattern **MTV** (Model-Template-View) :
- **Model** : Couche de données (ORM)
- **Template** : Présentation (HTML)
- **View** : Logique métier

## Installation et configuration

### Installation

```bash
# Installer Django
pip install django

# Ou avec Poetry
poetry add django
```

### Créer un projet

```bash
# Créer un nouveau projet
django-admin startproject monprojet

# Structure créée
monprojet/
├── manage.py
└── monprojet/
    ├── __init__.py
    ├── settings.py
    ├── urls.py
    └── wsgi.py
```

### Créer une application

```bash
# Dans le répertoire du projet
python manage.py startapp blog

# Structure de l'application
blog/
├── __init__.py
├── admin.py
├── apps.py
├── models.py
├── tests.py
├── views.py
└── migrations/
```

### Configuration de base

```python
# monprojet/settings.py
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'blog',  # Votre application
]

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}
```

## Modèles et ORM

### Définir un modèle

```python
# blog/models.py
from django.db import models
from django.contrib.auth.models import User

class Post(models.Model):
    title = models.CharField(max_length=200)
    content = models.TextField()
    author = models.ForeignKey(User, on_delete=models.CASCADE)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    published = models.BooleanField(default=False)

    class Meta:
        ordering = ['-created_at']
        verbose_name = "Article"
        verbose_name_plural = "Articles"

    def __str__(self):
        return self.title
```

### Migrations

```bash
# Créer les migrations
python manage.py makemigrations

# Appliquer les migrations
python manage.py migrate

# Voir le SQL généré
python manage.py sqlmigrate blog 0001
```

### Utiliser l'ORM

```python
from blog.models import Post
from django.contrib.auth.models import User

# Créer
post = Post.objects.create(
    title="Mon premier article",
    content="Contenu...",
    author=User.objects.first(),
    published=True
)

# Lire
posts = Post.objects.all()
published_posts = Post.objects.filter(published=True)
post = Post.objects.get(id=1)

# Mettre à jour
post.title = "Nouveau titre"
post.save()

# Supprimer
post.delete()

# Requêtes complexes
recent_posts = Post.objects.filter(
    published=True
).order_by('-created_at')[:10]

posts_by_author = Post.objects.filter(
    author__username='alice'
)
```

## Vues et templates

### Vues basées sur les fonctions

```python
# blog/views.py
from django.shortcuts import render, get_object_or_404
from django.http import HttpResponse
from .models import Post

def post_list(request):
    posts = Post.objects.filter(published=True)
    return render(request, 'blog/post_list.html', {'posts': posts})

def post_detail(request, post_id):
    post = get_object_or_404(Post, id=post_id, published=True)
    return render(request, 'blog/post_detail.html', {'post': post})
```

### Vues basées sur les classes

```python
from django.views.generic import ListView, DetailView
from .models import Post

class PostListView(ListView):
    model = Post
    template_name = 'blog/post_list.html'
    context_object_name = 'posts'
    
    def get_queryset(self):
        return Post.objects.filter(published=True)

class PostDetailView(DetailView):
    model = Post
    template_name = 'blog/post_detail.html'
    context_object_name = 'post'
```

### URLs

```python
# blog/urls.py
from django.urls import path
from . import views

urlpatterns = [
    path('', views.post_list, name='post_list'),
    path('<int:post_id>/', views.post_detail, name='post_detail'),
]

# Ou avec les vues de classe
from .views import PostListView, PostDetailView

urlpatterns = [
    path('', PostListView.as_view(), name='post_list'),
    path('<int:pk>/', PostDetailView.as_view(), name='post_detail'),
]
```

```python
# monprojet/urls.py
from django.contrib import admin
from django.urls import path, include

urlpatterns = [
    path('admin/', admin.site.urls),
    path('blog/', include('blog.urls')),
]
```

### Templates

```html
<!-- blog/templates/blog/post_list.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Articles</title>
</head>
<body>
    <h1>Liste des articles</h1>
    <ul>
        {% for post in posts %}
        <li>
            <a href="{% url 'post_detail' post.id %}">
                {{ post.title }}
            </a>
            <p>Par {{ post.author.username }} le {{ post.created_at|date:"d/m/Y" }}</p>
        </li>
        {% empty %}
        <li>Aucun article disponible</li>
        {% endfor %}
    </ul>
</body>
</html>
```

```html
<!-- blog/templates/blog/post_detail.html -->
<!DOCTYPE html>
<html>
<head>
    <title>{{ post.title }}</title>
</head>
<body>
    <h1>{{ post.title }}</h1>
    <p>Par {{ post.author.username }} le {{ post.created_at|date:"d/m/Y H:i" }}</p>
    <div>{{ post.content|linebreaks }}</div>
    <a href="{% url 'post_list' %}">Retour à la liste</a>
</body>
</html>
```

## Admin interface

### Enregistrer un modèle

```python
# blog/admin.py
from django.contrib import admin
from .models import Post

@admin.register(Post)
class PostAdmin(admin.ModelAdmin):
    list_display = ['title', 'author', 'created_at', 'published']
    list_filter = ['published', 'created_at']
    search_fields = ['title', 'content']
    date_hierarchy = 'created_at'
    ordering = ['-created_at']
    
    fieldsets = (
        ('Informations', {
            'fields': ('title', 'content', 'author')
        }),
        ('Publication', {
            'fields': ('published',)
        }),
    )
```

### Créer un superutilisateur

```bash
python manage.py createsuperuser
```

Accéder à l'admin : `http://127.0.0.1:8000/admin/`

## Formulaires

### Formulaires Django

```python
# blog/forms.py
from django import forms
from .models import Post

class PostForm(forms.ModelForm):
    class Meta:
        model = Post
        fields = ['title', 'content', 'published']
        widgets = {
            'content': forms.Textarea(attrs={'rows': 10}),
        }
```

### Utiliser les formulaires dans les vues

```python
# blog/views.py
from django.shortcuts import render, redirect
from .forms import PostForm
from .models import Post

def post_create(request):
    if request.method == 'POST':
        form = PostForm(request.POST)
        if form.is_valid():
            post = form.save(commit=False)
            post.author = request.user
            post.save()
            return redirect('post_detail', post_id=post.id)
    else:
        form = PostForm()
    return render(request, 'blog/post_form.html', {'form': form})
```

```html
<!-- blog/templates/blog/post_form.html -->
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Enregistrer</button>
</form>
```

## Authentification

### Système d'authentification intégré

```python
# blog/views.py
from django.contrib.auth.decorators import login_required
from django.contrib.auth import login, authenticate
from django.shortcuts import render, redirect

@login_required
def post_create(request):
    # Vue protégée
    pass

def login_view(request):
    if request.method == 'POST':
        username = request.POST['username']
        password = request.POST['password']
        user = authenticate(request, username=username, password=password)
        if user:
            login(request, user)
            return redirect('post_list')
    return render(request, 'blog/login.html')
```

### URLs d'authentification

```python
# monprojet/urls.py
from django.contrib.auth import views as auth_views

urlpatterns = [
    path('login/', auth_views.LoginView.as_view(), name='login'),
    path('logout/', auth_views.LogoutView.as_view(), name='logout'),
]
```

## API REST avec Django REST Framework

### Installation

```bash
pip install djangorestframework
```

### Configuration

```python
# settings.py
INSTALLED_APPS = [
    # ...
    'rest_framework',
]

REST_FRAMEWORK = {
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticated',
    ],
    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',
    'PAGE_SIZE': 10
}
```

### Serializers

```python
# blog/serializers.py
from rest_framework import serializers
from .models import Post

class PostSerializer(serializers.ModelSerializer):
    author_username = serializers.CharField(source='author.username', read_only=True)
    
    class Meta:
        model = Post
        fields = ['id', 'title', 'content', 'author_username', 'created_at', 'published']
        read_only_fields = ['created_at']
```

### ViewSets

```python
# blog/views.py
from rest_framework import viewsets
from rest_framework.permissions import IsAuthenticatedOrReadOnly
from .models import Post
from .serializers import PostSerializer

class PostViewSet(viewsets.ModelViewSet):
    queryset = Post.objects.all()
    serializer_class = PostSerializer
    permission_classes = [IsAuthenticatedOrReadOnly]
    
    def perform_create(self, serializer):
        serializer.save(author=self.request.user)
```

### URLs

```python
# blog/urls.py
from django.urls import path, include
from rest_framework.routers import DefaultRouter
from .views import PostViewSet

router = DefaultRouter()
router.register(r'posts', PostViewSet)

urlpatterns = [
    path('api/', include(router.urls)),
]
```

## Cas d'usage

### Cas d'usage 1 : Blog complet

```python
# blog/models.py
from django.db import models
from django.contrib.auth.models import User

class Category(models.Model):
    name = models.CharField(max_length=100)
    slug = models.SlugField(unique=True)

class Post(models.Model):
    title = models.CharField(max_length=200)
    slug = models.SlugField(unique=True)
    content = models.TextField()
    author = models.ForeignKey(User, on_delete=models.CASCADE)
    category = models.ForeignKey(Category, on_delete=models.SET_NULL, null=True)
    created_at = models.DateTimeField(auto_now_add=True)
    published = models.BooleanField(default=False)

class Comment(models.Model):
    post = models.ForeignKey(Post, on_delete=models.CASCADE, related_name='comments')
    author = models.ForeignKey(User, on_delete=models.CASCADE)
    content = models.TextField()
    created_at = models.DateTimeField(auto_now_add=True)
```

### Cas d'usage 2 : E-commerce

```python
# shop/models.py
from django.db import models

class Product(models.Model):
    name = models.CharField(max_length=200)
    price = models.DecimalField(max_digits=10, decimal_places=2)
    stock = models.IntegerField(default=0)
    description = models.TextField()

class Order(models.Model):
    STATUS_CHOICES = [
        ('pending', 'En attente'),
        ('paid', 'Payé'),
        ('shipped', 'Expédié'),
        ('delivered', 'Livré'),
    ]
    customer = models.ForeignKey(User, on_delete=models.CASCADE)
    status = models.CharField(max_length=20, choices=STATUS_CHOICES, default='pending')
    created_at = models.DateTimeField(auto_now_add=True)
    total = models.DecimalField(max_digits=10, decimal_places=2)

class OrderItem(models.Model):
    order = models.ForeignKey(Order, on_delete=models.CASCADE, related_name='items')
    product = models.ForeignKey(Product, on_delete=models.CASCADE)
    quantity = models.IntegerField()
    price = models.DecimalField(max_digits=10, decimal_places=2)
```

## Bonnes pratiques

### 1. Utilisez les migrations

```bash
# ✅ Toujours créer des migrations pour les changements de modèles
python manage.py makemigrations
python manage.py migrate
```

### 2. Organisez avec des apps

```bash
# ✅ Séparer les fonctionnalités en applications distinctes
python manage.py startapp blog
python manage.py startapp shop
python manage.py startapp accounts
```

### 3. Utilisez les vues génériques

```python
# ✅ Utiliser les vues génériques pour réduire le code
from django.views.generic import ListView, DetailView, CreateView, UpdateView
```

### 4. Sécurité

```python
# ✅ Toujours utiliser CSRF protection
{% csrf_token %}

# ✅ Valider les permissions
@login_required
@permission_required('blog.add_post')
```

## Points clés à retenir

- ✅ Django est un framework **full-stack** complet
- ✅ **ORM puissant** intégré
- ✅ **Interface d'administration** automatique
- ✅ **Sécurité** intégrée (CSRF, XSS, SQL injection, etc.)
- ✅ **Système d'authentification** complet
- ✅ **Templates** avec système de tags puissant
- ✅ Parfait pour les **applications web complètes** et les **sites web**

Django est idéal pour développer rapidement des applications web complètes avec toutes les fonctionnalités nécessaires intégrées. Son approche "batteries included" permet de se concentrer sur la logique métier plutôt que sur l'infrastructure.
